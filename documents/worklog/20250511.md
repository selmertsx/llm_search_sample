# 手順

- まずはAgent単体で試す
  - モデルは使い慣れてる geminiを使う
  - geminiでワンパス通した後、別モデルでも試してみる
- Next.jsのアプリケーションに乗っけてみる

# まずはAgent単体で動かしてみる

## 目的

- いきなりフロントまで含めて作るのは手間
- まずはlocalで試行錯誤して、良いAgentを見つけたい
- ということで `yarn tsx scripts/search_with_mastra.ts` で探す

## 普通のAgentで動作確認

```typescript
import { Agent } from "@mastra/core/agent";
import { google } from "@ai-sdk/google";
import { Message } from "@ai-sdk/ui-utils";
import { z } from "zod";

const PersonInfoSchema = z.object({
  fullName: z.string().describe("本名"),
  company: z.string().describe("所属会社"),
  department: z.string().describe("所属部署"),
});

async function main() {
  const agent = new Agent({
    name: "PeasonSearchAgent",
    instructions: "You are a helpful AI assistant that searches for person.",
    model: google("gemini-2.5-pro-preview-05-06", {
      useSearchGrounding: true,
    }),
  });

  const prompt: Message = {
    id: "1",
    role: "user",
    content:
      "github accountのaccount名がselmertsxという人がいます。この人の本名と所属会社、所属部署を教えてください",
  };

  const result = await agent.generate([prompt], {
    output: PersonInfoSchema,
  });
  console.log(result);
}

main();
```

上記のコマンドで実行すると全然違う人が出てきた。
普通にテキストで検索すると正しい答えが返ってくる。
なので、まずテキストで検索して、その結果から構造化しようと思う

## 一度テキストで生成して検索してみる

```typescript
import { Agent } from "@mastra/core/agent";
import { google } from "@ai-sdk/google";
import { Message } from "@ai-sdk/ui-utils";
import { z } from "zod";

const PersonInfoSchema = z.object({
  fullName: z.string().describe("本名"),
  company: z.string().describe("所属会社"),
  department: z.string().describe("所属部署"),
});

async function main() {
  const agent = new Agent({
    name: "PeasonSearchAgent",
    instructions: "You are a helpful AI assistant that searches for person.",
    model: google("gemini-2.5-pro-preview-05-06", {
      useSearchGrounding: true,
    }),
  });

  const rawResult = await agent.generate(
    "github accountのaccount名がselmertsxという人がいます。この人の本名と所属会社、所属部署を教えてください"
  );

  const prompt: Message = {
    id: "1",
    role: "user",
    content: `これからある人物に関して検索したテキストを渡す。ここから指定されたフォーマットに従い、その人物の情報を抽出してください。
    検索したテキスト: ${rawResult.text}
    `,
  };

  const result = await agent.generate([prompt], {
    output: PersonInfoSchema,
  });

  console.log(result);
}

main();
```

これで取得した結果は下記

```json
{ "fullName": "合ってる", "company": "合ってる", "department": "合ってる" }
```

ということで大丈夫そう。この方針で進めよう

その前に軌道修正。人で検索するのは良くないかもだから、ossのpackageで探すかなあ。
例えば mastra って入れたら、どんなlibraryか。似たようなlibraryにどのようなものがあるか。
導入している会社はどこか。どんな使い方をしているか(参考記事添えて)。みたいな感じでやろう。

# Next.js のアプリケーションを作ってみる

## directory設計を考える

ここ１〜２年Pythonばっかり触ってた。
なので、最近はどんなディレクトリ設計が一般的か分からず。
色んなディレクトリを見て調べてみよう。

公式サンプル見るとこんな感じ。
https://github.com/vercel/nextjs-optimizely-experimentation

```
src/app
src/components
src/lib
```

https://github.com/vercel/ai-chatbot

```
src/app
src/components/
src/lib
src/hooks
src/artifacts
```

なるほど。概ね把握。
この ai-chatbotを例に考えていこうかな

## テンションを上げるため簡単にきれいな画面を作る

figmaと繋いで作りたいけど、本筋からずれないように。
仕様としては、まず oss のライブラリ名を入れるフォームがほしいな。
ui componentを入れてみようか。
ui componentのライブラリは重要ではないので、深く考えずにmaterial-uiを入れる
